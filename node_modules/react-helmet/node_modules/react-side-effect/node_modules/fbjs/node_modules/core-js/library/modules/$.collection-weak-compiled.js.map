{"version":3,"sources":["$.collection-weak.js"],"names":[],"mappings":"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","file":"$.collection-weak-compiled.js","sourcesContent":["'use strict';\nvar hide              = require('./$.hide')\n  , redefineAll       = require('./$.redefine-all')\n  , anObject          = require('./$.an-object')\n  , isObject          = require('./$.is-object')\n  , strictNew         = require('./$.strict-new')\n  , forOf             = require('./$.for-of')\n  , createArrayMethod = require('./$.array-methods')\n  , $has              = require('./$.has')\n  , WEAK              = require('./$.uid')('weak')\n  , isExtensible      = Object.isExtensible || isObject\n  , arrayFind         = createArrayMethod(5)\n  , arrayFindIndex    = createArrayMethod(6)\n  , id                = 0;\n\n// fallback for frozen keys\nvar frozenStore = function(that){\n  return that._l || (that._l = new FrozenStore);\n};\nvar FrozenStore = function(){\n  this.a = [];\n};\nvar findFrozen = function(store, key){\n  return arrayFind(store.a, function(it){\n    return it[0] === key;\n  });\n};\nFrozenStore.prototype = {\n  get: function(key){\n    var entry = findFrozen(this, key);\n    if(entry)return entry[1];\n  },\n  has: function(key){\n    return !!findFrozen(this, key);\n  },\n  set: function(key, value){\n    var entry = findFrozen(this, key);\n    if(entry)entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function(key){\n    var index = arrayFindIndex(this.a, function(it){\n      return it[0] === key;\n    });\n    if(~index)this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){\n    var C = wrapper(function(that, iterable){\n      strictNew(that, C, NAME);\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for frozen objects\n      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this)['delete'](key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i) && delete key[WEAK][this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this).has(key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i);\n      }\n    });\n    return C;\n  },\n  def: function(that, key, value){\n    if(!isExtensible(anObject(key))){\n      frozenStore(that).set(key, value);\n    } else {\n      $has(key, WEAK) || hide(key, WEAK, {});\n      key[WEAK][that._i] = value;\n    } return that;\n  },\n  frozenStore: frozenStore,\n  WEAK: WEAK\n};"]}