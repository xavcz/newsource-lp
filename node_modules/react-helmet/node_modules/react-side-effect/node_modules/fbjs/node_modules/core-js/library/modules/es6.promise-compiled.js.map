{"version":3,"sources":["es6.promise.js"],"names":[],"mappings":"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","file":"es6.promise-compiled.js","sourcesContent":["'use strict';\nvar $          = require('./$')\n  , LIBRARY    = require('./$.library')\n  , global     = require('./$.global')\n  , ctx        = require('./$.ctx')\n  , classof    = require('./$.classof')\n  , $export    = require('./$.export')\n  , isObject   = require('./$.is-object')\n  , anObject   = require('./$.an-object')\n  , aFunction  = require('./$.a-function')\n  , strictNew  = require('./$.strict-new')\n  , forOf      = require('./$.for-of')\n  , setProto   = require('./$.set-proto').set\n  , same       = require('./$.same-value')\n  , SPECIES    = require('./$.wks')('species')\n  , speciesConstructor = require('./$.species-constructor')\n  , asap       = require('./$.microtask')\n  , PROMISE    = 'Promise'\n  , process    = global.process\n  , isNode     = classof(process) == 'process'\n  , P          = global[PROMISE]\n  , Wrapper;\n\nvar testResolve = function(sub){\n  var test = new P(function(){});\n  if(sub)test.constructor = Object;\n  return P.resolve(test) === test;\n};\n\nvar USE_NATIVE = function(){\n  var works = false;\n  function P2(x){\n    var self = new P(x);\n    setProto(self, P2.prototype);\n    return self;\n  }\n  try {\n    works = P && P.resolve && testResolve();\n    setProto(P2, P);\n    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});\n    // actual Firefox has broken subclass support, test that\n    if(!(P2.resolve(5).then(function(){}) instanceof P2)){\n      works = false;\n    }\n    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162\n    if(works && require('./$.descriptors')){\n      var thenableThenGotten = false;\n      P.resolve($.setDesc({}, 'then', {\n        get: function(){ thenableThenGotten = true; }\n      }));\n      works = thenableThenGotten;\n    }\n  } catch(e){ works = false; }\n  return works;\n}();\n\n// helpers\nvar sameConstructor = function(a, b){\n  // library wrapper special case\n  if(LIBRARY && a === P && b === Wrapper)return true;\n  return same(a, b);\n};\nvar getConstructor = function(C){\n  var S = anObject(C)[SPECIES];\n  return S != undefined ? S : C;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar PromiseCapability = function(C){\n  var resolve, reject;\n  this.promise = new C(function($$resolve, $$reject){\n    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject  = $$reject;\n  });\n  this.resolve = aFunction(resolve),\n  this.reject  = aFunction(reject)\n};\nvar perform = function(exec){\n  try {\n    exec();\n  } catch(e){\n    return {error: e};\n  }\n};\nvar notify = function(record, isReject){\n  if(record.n)return;\n  record.n = true;\n  var chain = record.c;\n  asap(function(){\n    var value = record.v\n      , ok    = record.s == 1\n      , i     = 0;\n    var run = function(reaction){\n      var handler = ok ? reaction.ok : reaction.fail\n        , resolve = reaction.resolve\n        , reject  = reaction.reject\n        , result, then;\n      try {\n        if(handler){\n          if(!ok)record.h = true;\n          result = handler === true ? value : handler(value);\n          if(result === reaction.promise){\n            reject(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(result)){\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch(e){\n        reject(e);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    chain.length = 0;\n    record.n = false;\n    if(isReject)setTimeout(function(){\n      var promise = record.p\n        , handler, console;\n      if(isUnhandled(promise)){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      } record.a = undefined;\n    }, 1);\n  });\n};\nvar isUnhandled = function(promise){\n  var record = promise._d\n    , chain  = record.a || record.c\n    , i      = 0\n    , reaction;\n  if(record.h)return false;\n  while(chain.length > i){\n    reaction = chain[i++];\n    if(reaction.fail || !isUnhandled(reaction.promise))return false;\n  } return true;\n};\nvar $reject = function(value){\n  var record = this;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  record.v = value;\n  record.s = 2;\n  record.a = record.c.slice();\n  notify(record, true);\n};\nvar $resolve = function(value){\n  var record = this\n    , then;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  try {\n    if(record.p === value)throw TypeError(\"Promise can't be resolved itself\");\n    if(then = isThenable(value)){\n      asap(function(){\n        var wrapper = {r: record, d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      record.v = value;\n      record.s = 1;\n      notify(record, false);\n    }\n  } catch(e){\n    $reject.call({r: record, d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!USE_NATIVE){\n  // 25.4.3.1 Promise(executor)\n  P = function Promise(executor){\n    aFunction(executor);\n    var record = this._d = {\n      p: strictNew(this, P, PROMISE),         // <- promise\n      c: [],                                  // <- awaiting reactions\n      a: undefined,                           // <- checked in isUnhandled reactions\n      s: 0,                                   // <- state\n      d: false,                               // <- done\n      v: undefined,                           // <- value\n      h: false,                               // <- handled rejection\n      n: false                                // <- notify\n    };\n    try {\n      executor(ctx($resolve, record, 1), ctx($reject, record, 1));\n    } catch(err){\n      $reject.call(record, err);\n    }\n  };\n  require('./$.redefine-all')(P.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var reaction = new PromiseCapability(speciesConstructor(this, P))\n        , promise  = reaction.promise\n        , record   = this._d;\n      reaction.ok   = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      record.c.push(reaction);\n      if(record.a)record.a.push(reaction);\n      if(record.s)notify(record, false);\n      return promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: P});\nrequire('./$.set-to-string-tag')(P, PROMISE);\nrequire('./$.set-species')(PROMISE);\nWrapper = require('./$.core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    var capability = new PromiseCapability(this)\n      , $$reject   = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (!USE_NATIVE || testResolve(true)), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    // instanceof instead of internal slot check because we should fix it without replacement native Promise core\n    if(x instanceof P && sameConstructor(x.constructor, this))return x;\n    var capability = new PromiseCapability(this)\n      , $$resolve  = capability.resolve;\n    $$resolve(x);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./$.iter-detect')(function(iter){\n  P.all(iter)['catch'](function(){});\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , resolve    = capability.resolve\n      , reject     = capability.reject\n      , values     = [];\n    var abrupt = perform(function(){\n      forOf(iterable, false, values.push, values);\n      var remaining = values.length\n        , results   = Array(remaining);\n      if(remaining)$.each.call(values, function(promise, index){\n        var alreadyCalled = false;\n        C.resolve(promise).then(function(value){\n          if(alreadyCalled)return;\n          alreadyCalled = true;\n          results[index] = value;\n          --remaining || resolve(results);\n        }, reject);\n      });\n      else resolve(results);\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  }\n});"]}