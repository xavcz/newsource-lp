{"version":3,"sources":["rejection-tracking.js"],"names":[],"mappings":"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","file":"rejection-tracking-compiled.js","sourcesContent":["'use strict';\n\nvar Promise = require('./core');\n\nvar DEFAULT_WHITELIST = [\n  ReferenceError,\n  TypeError,\n  RangeError\n];\n\nvar enabled = false;\nexports.disable = disable;\nfunction disable() {\n  enabled = false;\n  Promise._onHandle = null;\n  Promise._onReject = null;\n}\n\nexports.enable = enable;\nfunction enable(options) {\n  options = options || {};\n  if (enabled) disable();\n  enabled = true;\n  var id = 0;\n  var displayId = 0;\n  var rejections = {};\n  Promise._onHandle = function (promise) {\n    if (\n      promise._state === 2 && // IS REJECTED\n      rejections[promise._rejectionId]\n    ) {\n      if (rejections[promise._rejectionId].logged) {\n        onHandled(promise._rejectionId);\n      } else {\n        clearTimeout(rejections[promise._rejectionId].timeout);\n      }\n      delete rejections[promise._rejectionId];\n    }\n  };\n  Promise._onReject = function (promise, err) {\n    if (promise._deferredState === 0) { // not yet handled\n      promise._rejectionId = id++;\n      rejections[promise._rejectionId] = {\n        displayId: null,\n        error: err,\n        timeout: setTimeout(\n          onUnhandled.bind(null, promise._rejectionId),\n          // For reference errors and type errors, this almost always\n          // means the programmer made a mistake, so log them after just\n          // 100ms\n          // otherwise, wait 2 seconds to see if they get handled\n          matchWhitelist(err, DEFAULT_WHITELIST)\n            ? 100\n            : 2000\n        ),\n        logged: false\n      };\n    }\n  };\n  function onUnhandled(id) {\n    if (\n      options.allRejections ||\n      matchWhitelist(\n        rejections[id].error,\n        options.whitelist || DEFAULT_WHITELIST\n      )\n    ) {\n      rejections[id].displayId = displayId++;\n      if (options.onUnhandled) {\n        rejections[id].logged = true;\n        options.onUnhandled(\n          rejections[id].displayId,\n          rejections[id].error\n        );\n      } else {\n        rejections[id].logged = true;\n        logError(\n          rejections[id].displayId,\n          rejections[id].error\n        );\n      }\n    }\n  }\n  function onHandled(id) {\n    if (rejections[id].logged) {\n      if (options.onHandled) {\n        options.onHandled(rejections[id].displayId, rejections[id].error);\n      } else if (!rejections[id].onUnhandled) {\n        console.warn(\n          'Promise Rejection Handled (id: ' + rejections[id].displayId + '):'\n        );\n        console.warn(\n          '  This means you can ignore any previous messages of the form \"Possible Unhandled Promise Rejection\" with id ' +\n          rejections[id].displayId + '.'\n        );\n      }\n    }\n  }\n}\n\nfunction logError(id, error) {\n  console.warn('Possible Unhandled Promise Rejection (id: ' + id + '):');\n  var errStr = (error && (error.stack || error)) + '';\n  errStr.split('\\n').forEach(function (line) {\n    console.warn('  ' + line);\n  });\n}\n\nfunction matchWhitelist(error, list) {\n  return list.some(function (cls) {\n    return error instanceof cls;\n  });\n}"]}