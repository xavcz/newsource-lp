{"version":3,"sources":["node-extensions.js"],"names":[],"mappings":"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","file":"node-extensions-compiled.js","sourcesContent":["'use strict';\n\n// This file contains then/promise specific extensions that are only useful\n// for node.js interop\n\nvar Promise = require('./core.js');\nvar asap = require('asap');\n\nmodule.exports = Promise;\n\n/* Static Functions */\n\nPromise.denodeify = function (fn, argumentCount) {\n  if (\n    typeof argumentCount === 'number' && argumentCount !== Infinity\n  ) {\n    return denodeifyWithCount(fn, argumentCount);\n  } else {\n    return denodeifyWithoutCount(fn);\n  }\n}\n\nvar callbackFn = (\n  'function (err, res) {' +\n  'if (err) { rj(err); } else { rs(res); }' +\n  '}'\n);\nfunction denodeifyWithCount(fn, argumentCount) {\n  var args = [];\n  for (var i = 0; i < argumentCount; i++) {\n    args.push('a' + i);\n  }\n  var body = [\n    'return function (' + args.join(',') + ') {',\n    'var self = this;',\n    'return new Promise(function (rs, rj) {',\n    'var res = fn.call(',\n    ['self'].concat(args).concat([callbackFn]).join(','),\n    ');',\n    'if (res &&',\n    '(typeof res === \"object\" || typeof res === \"function\") &&',\n    'typeof res.then === \"function\"',\n    ') {rs(res);}',\n    '});',\n    '};'\n  ].join('');\n  return Function(['Promise', 'fn'], body)(Promise, fn);\n}\nfunction denodeifyWithoutCount(fn) {\n  var fnLength = Math.max(fn.length - 1, 3);\n  var args = [];\n  for (var i = 0; i < fnLength; i++) {\n    args.push('a' + i);\n  }\n  var body = [\n    'return function (' + args.join(',') + ') {',\n    'var self = this;',\n    'var args;',\n    'var argLength = arguments.length;',\n    'if (arguments.length > ' + fnLength + ') {',\n    'args = new Array(arguments.length + 1);',\n    'for (var i = 0; i < arguments.length; i++) {',\n    'args[i] = arguments[i];',\n    '}',\n    '}',\n    'return new Promise(function (rs, rj) {',\n    'var cb = ' + callbackFn + ';',\n    'var res;',\n    'switch (argLength) {',\n    args.concat(['extra']).map(function (_, index) {\n      return (\n        'case ' + (index) + ':' +\n        'res = fn.call(' + ['self'].concat(args.slice(0, index)).concat('cb').join(',') + ');' +\n        'break;'\n      );\n    }).join(''),\n    'default:',\n    'args[argLength] = cb;',\n    'res = fn.apply(self, args);',\n    '}',\n    \n    'if (res &&',\n    '(typeof res === \"object\" || typeof res === \"function\") &&',\n    'typeof res.then === \"function\"',\n    ') {rs(res);}',\n    '});',\n    '};'\n  ].join('');\n\n  return Function(\n    ['Promise', 'fn'],\n    body\n  )(Promise, fn);\n}\n\nPromise.nodeify = function (fn) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n    var callback =\n      typeof args[args.length - 1] === 'function' ? args.pop() : null;\n    var ctx = this;\n    try {\n      return fn.apply(this, arguments).nodeify(callback, ctx);\n    } catch (ex) {\n      if (callback === null || typeof callback == 'undefined') {\n        return new Promise(function (resolve, reject) {\n          reject(ex);\n        });\n      } else {\n        asap(function () {\n          callback.call(ctx, ex);\n        })\n      }\n    }\n  }\n}\n\nPromise.prototype.nodeify = function (callback, ctx) {\n  if (typeof callback != 'function') return this;\n\n  this.then(function (value) {\n    asap(function () {\n      callback.call(ctx, null, value);\n    });\n  }, function (err) {\n    asap(function () {\n      callback.call(ctx, err);\n    });\n  });\n}\n"]}