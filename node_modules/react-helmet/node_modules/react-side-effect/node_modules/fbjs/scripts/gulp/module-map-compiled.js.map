{"version":3,"sources":["module-map.js"],"names":[],"mappings":";;;;;;;;;AASA,YAAY,CAAC;;AAEb,IAAI,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AACjC,IAAI,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAClC,IAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACvB,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;;AAE3B,IAAI,SAAS,GAAG,sCAAsC,CAAC;;AAEvD,IAAI,WAAW,GAAG,YAAY,CAAC;;AAE/B,MAAM,CAAC,OAAO,GAAG,UAAS,IAAI,EAAE;;AAE9B,MAAI,CAAC,IAAI,IAAI,EAAE,eAAe,IAAI,IAAI,IAAI,QAAQ,IAAI,IAAI,CAAA,AAAC,EAAE;AAC3D,UAAM,IAAI,KAAK,CAAC,WAAW,CACzB,WAAW,EACX,8EAA8E,CAC/E,CAAC;GACH;AACD,MAAI,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;AACvC,MAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AACzB,MAAI,SAAS,GAAG,EAAE,CAAC;;AAEnB,WAAS,SAAS,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE;AAChC,QAAI,IAAI,CAAC,MAAM,EAAE,EAAE;AACjB,QAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACf,aAAO;KACR;;AAED,QAAI,IAAI,CAAC,QAAQ,EAAE,EAAE;AACnB,QAAE,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC,YAAY,EAAE,yBAAyB,CAAC,CAAC,CAAC;AACnE,aAAO;KACR;;;AAGD,QAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;AACxD,QAAI,OAAO,EAAE;AACX,UAAI,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AACtB,UAAI,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;AAClC,YAAI,CAAC,IAAI,CACP,OAAO,EACP,IAAI,KAAK,CAAC,WAAW,CACnB,WAAW,EACX,0BAA0B,GAAG,IAAI,GAAG,MAAM,GAAG,IAAI,CAAC,IAAI,GAAG,OAAO,GAC9D,SAAS,CAAC,IAAI,CAAC,CAClB,CACF,CAAC;OACH;AACD,eAAS,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC;KAC7B;AACD,QAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAChB,MAAE,EAAE,CAAC;GACN;;AAED,WAAS,KAAK,CAAC,EAAE,EAAE;;AAEjB,QAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,UAAS,IAAI,EAAE,IAAI,EAAE;;AAElE,UAAI,CAAC,IAAI,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;AAC5D,aAAO,IAAI,CAAC;KACb,EAAE,EAAE,CAAC,CAAC;AACP,MAAE,CAAC,SAAS,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,YAAW;;AAE5E,QAAE,EAAE,CAAC;KACN,CAAC,CAAC;GACJ;;AAED,SAAO,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;CACtC,CAAC","file":"module-map-compiled.js","sourcesContent":["/**\n * Copyright 2013-2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n'use strict';\n\nvar gutil = require('gulp-util');\nvar through = require('through2');\nvar fs = require('fs');\nvar path = require('path');\n\nvar PM_REGEXP = /\\r?\\n \\* \\@providesModule (\\S+)\\r?\\n/;\n\nvar PLUGIN_NAME = 'module-map';\n\nmodule.exports = function(opts) {\n  // Assume file is a string for now\n  if (!opts || !('moduleMapFile' in opts && 'prefix' in opts)) {\n    throw new gutil.PluginError(\n      PLUGIN_NAME,\n      'Missing options. Ensure you pass an object with `moduleMapFile` and `prefix`'\n    );\n  }\n  var moduleMapFile = opts.moduleMapFile;\n  var prefix = opts.prefix;\n  var moduleMap = {};\n\n  function transform(file, enc, cb) {\n    if (file.isNull()) {\n      cb(null, file);\n      return;\n    }\n\n    if (file.isStream()) {\n      cb(new gutil.PluginError('module-map', 'Streaming not supported'));\n      return;\n    }\n\n    // Get the @providesModule piece of out the file and save that.\n    var matches = file.contents.toString().match(PM_REGEXP);\n    if (matches) {\n      var name = matches[1];\n      if (moduleMap.hasOwnProperty(name)) {\n        this.emit(\n          'error',\n          new gutil.PluginError(\n            PLUGIN_NAME,\n            'Duplicate module found: ' + name + ' at ' + file.path + ' and ' +\n              moduleMap[name]\n          )\n        );\n      }\n      moduleMap[name] = file.path;\n    }\n    this.push(file);\n    cb();\n  }\n\n  function flush(cb) {\n    // Keep it ABC order for better diffing.\n    var map = Object.keys(moduleMap).sort().reduce(function(prev, curr) {\n      // Rewrite path here since we don't need the full path anymore.\n      prev[curr] = prefix + path.basename(moduleMap[curr], '.js');\n      return prev;\n    }, {});\n    fs.writeFile(moduleMapFile, JSON.stringify(map, null, 2), 'utf-8', function() {\n      // avoid calling cb with fs.write callback data\n      cb();\n    });\n  }\n\n  return through.obj(transform, flush);\n};\n"]}