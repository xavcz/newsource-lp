{"version":3,"sources":["test-zlib.js"],"names":[],"mappings":"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","file":"test-zlib-compiled.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar assert = require('assert');\nvar zlib = require('../');\nvar path = require('path');\n\nvar zlibPairs =\n    [[zlib.Deflate, zlib.Inflate],\n     [zlib.Gzip, zlib.Gunzip],\n     [zlib.Deflate, zlib.Unzip],\n     [zlib.Gzip, zlib.Unzip],\n     [zlib.DeflateRaw, zlib.InflateRaw]];\n\n// how fast to trickle through the slowstream\nvar trickle = [128, 1024, 1024 * 1024];\n\n// tunable options for zlib classes.\n\n// several different chunk sizes\nvar chunkSize = [128, 1024, 1024 * 16, 1024 * 1024];\n\n// this is every possible value.\nvar level = [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\nvar windowBits = [8, 9, 10, 11, 12, 13, 14, 15];\nvar memLevel = [1, 2, 3, 4, 5, 6, 7, 8, 9];\nvar strategy = [0, 1, 2, 3, 4];\n\n// it's nice in theory to test every combination, but it\n// takes WAY too long.  Maybe a pummel test could do this?\nif (!process.env.PUMMEL) {\n  trickle = [1024];\n  chunkSize = [1024 * 16];\n  level = [6];\n  memLevel = [8];\n  windowBits = [15];\n  strategy = [0];\n}\n\nvar fs = require('fs');\n\nif (process.env.FAST) {\n  zlibPairs = [[zlib.Gzip, zlib.Unzip]];\n}\n\nvar tests = {\n  'person.jpg': fs.readFileSync(__dirname + '/fixtures/person.jpg'),\n  'elipses.txt': fs.readFileSync(__dirname + '/fixtures/elipses.txt'),\n  'empty.txt': fs.readFileSync(__dirname + '/fixtures/empty.txt')\n};\n\nvar util = require('util');\nvar stream = require('stream');\n\n\n// stream that saves everything\nfunction BufferStream() {\n  this.chunks = [];\n  this.length = 0;\n  this.writable = true;\n  this.readable = true;\n}\n\nutil.inherits(BufferStream, stream.Stream);\n\nBufferStream.prototype.write = function(c) {\n  this.chunks.push(c);\n  this.length += c.length;\n  return true;\n};\n\nBufferStream.prototype.end = function(c) {\n  if (c) this.write(c);\n  // flatten\n  var buf = new Buffer(this.length);\n  var i = 0;\n  this.chunks.forEach(function(c) {\n    c.copy(buf, i);\n    i += c.length;\n  });\n  this.emit('data', buf);\n  this.emit('end');\n  return true;\n};\n\n\nfunction SlowStream(trickle) {\n  this.trickle = trickle;\n  this.offset = 0;\n  this.readable = this.writable = true;\n}\n\nutil.inherits(SlowStream, stream.Stream);\n\nSlowStream.prototype.write = function() {\n  throw new Error('not implemented, just call ss.end(chunk)');\n};\n\nSlowStream.prototype.pause = function() {\n  this.paused = true;\n  this.emit('pause');\n};\n\nSlowStream.prototype.resume = function() {\n  var self = this;\n  if (self.ended) return;\n  self.emit('resume');\n  if (!self.chunk) return;\n  self.paused = false;\n  emit();\n  function emit() {\n    if (self.paused) return;\n    if (self.offset >= self.length) {\n      self.ended = true;\n      return self.emit('end');\n    }\n    var end = Math.min(self.offset + self.trickle, self.length);\n    var c = self.chunk.slice(self.offset, end);\n    self.offset += c.length;\n    self.emit('data', c);\n    process.nextTick(emit);\n  }\n};\n\nSlowStream.prototype.end = function(chunk) {\n  // walk over the chunk in blocks.\n  var self = this;\n  self.chunk = chunk;\n  self.length = chunk.length;\n  self.resume();\n  return self.ended;\n};\n\n\n\n// for each of the files, make sure that compressing and\n// decompressing results in the same data, for every combination\n// of the options set above.\nvar tape = require('tape');\n\nObject.keys(tests).forEach(function(file) {\n  var test = tests[file];\n  chunkSize.forEach(function(chunkSize) {\n    trickle.forEach(function(trickle) {\n      windowBits.forEach(function(windowBits) {\n        level.forEach(function(level) {\n          memLevel.forEach(function(memLevel) {\n            strategy.forEach(function(strategy) {\n              zlibPairs.forEach(function(pair) {\n                var Def = pair[0];\n                var Inf = pair[1];\n                var opts = { \n                  level: level,\n                  windowBits: windowBits,\n                  memLevel: memLevel,\n                  strategy: strategy\n                };\n                \n                var msg = file + ' ' +\n                    chunkSize + ' ' +\n                    JSON.stringify(opts) + ' ' +\n                    Def.name + ' -> ' + Inf.name;\n                \n                tape('zlib ' + msg, function(t) {\n                  t.plan(1);\n                  \n                  var def = new Def(opts);\n                  var inf = new Inf(opts);\n                  var ss = new SlowStream(trickle);\n                  var buf = new BufferStream();\n\n                  // verify that the same exact buffer comes out the other end.\n                  buf.on('data', function(c) {\n                    t.deepEqual(c, test);\n                  });\n\n                  // the magic happens here.\n                  ss.pipe(def).pipe(inf).pipe(buf);\n                  ss.end(test);\n                });\n              });\n            });\n          });\n        });\n      });\n    }); \n  });\n});\n"]}