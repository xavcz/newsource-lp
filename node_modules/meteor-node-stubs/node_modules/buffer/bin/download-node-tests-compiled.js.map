{"version":3,"sources":["download-node-tests.js"],"names":[],"mappings":"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","file":"download-node-tests-compiled.js","sourcesContent":["#!/usr/bin/env node\n\nvar concat = require('concat-stream')\nvar cp = require('child_process')\nvar fs = require('fs')\nvar hyperquest = require('hyperquest')\nvar path = require('path')\nvar split = require('split')\nvar through = require('through2')\n\nvar url = 'https://api.github.com/repos/nodejs/io.js/contents'\nvar dirs = [\n  '/test/parallel',\n  '/test/pummel'\n]\n\ncp.execSync('rm -rf node/*.js', { cwd: path.join(__dirname, '../test') })\ncp.execSync('rm -rf node-es6/*.js', { cwd: path.join(__dirname, '../test') })\n\nvar httpOpts = {\n  headers: {\n    'User-Agent': null\n    // auth if github rate-limits you...\n    // 'Authorization': 'Basic ' + Buffer('username:password').toString('base64'),\n  }\n}\n\ndirs.forEach(function (dir) {\n  var req = hyperquest(url + dir, httpOpts)\n  req.pipe(concat(function (data) {\n    if (req.response.statusCode !== 200) {\n      throw new Error(url + dir + ': ' + data.toString())\n    }\n    downloadBufferTests(dir, JSON.parse(data))\n  }))\n})\n\nfunction downloadBufferTests (dir, files) {\n  files.forEach(function (file) {\n    if (!/test-buffer.*/.test(file.name)) return\n\n    var out\n    if (file.name === 'test-buffer-iterator.js' ||\n        file.name === 'test-buffer-arraybuffer.js') {\n      out = path.join(__dirname, '../test/node-es6', file.name)\n    } else if (file.name === 'test-buffer-fakes.js') {\n      // These teses only apply to node, where they're calling into C++ and need to\n      // ensure the prototype can't be faked, or else there will be a segfault.\n      return\n    } else {\n      out = path.join(__dirname, '../test/node', file.name)\n    }\n\n    console.log(file.download_url)\n    hyperquest(file.download_url, httpOpts)\n      .pipe(split())\n      .pipe(testfixer(file.name))\n      .pipe(fs.createWriteStream(out))\n      .on('finish', function () {\n        console.log('wrote ' + file.name)\n      })\n  })\n}\n\nfunction testfixer (filename) {\n  var firstline = true\n\n  return through(function (line, enc, cb) {\n    line = line.toString()\n\n    if (firstline) {\n      // require buffer explicitly\n      var preamble = 'if (process.env.OBJECT_IMPL) global.TYPED_ARRAY_SUPPORT = false;\\n' +\n      'var Buffer = require(\\'../../\\').Buffer;'\n      if (/use strict/.test(line)) line += '\\n' + preamble\n      else line + preamble + '\\n' + line\n      firstline = false\n    }\n\n    // use `var` instead of `const`/`let`\n    line = line.replace(/(const|let) /g, 'var ')\n\n    // make `require('common')` work\n    line = line.replace(/(var common = require.*)/g, 'var common = {};')\n\n    // use `Buffer.isBuffer` instead of `instanceof Buffer`\n    line = line.replace(/buf instanceof Buffer/g, 'Buffer.isBuffer(buf)')\n\n    // require browser buffer\n    line = line.replace(/(.*)require\\('buffer'\\)(.*)/g, '$1require(\\'../../\\')$2')\n\n    // smalloc is only used for kMaxLength\n    line = line.replace(\n      /require\\('smalloc'\\)/g,\n      '{ kMaxLength: process.env.OBJECT_IMPL ? 0x3fffffff : 0x7fffffff }'\n    )\n\n    // comment out console logs\n    line = line.replace(/(.*console\\..*)/g, '// $1')\n\n    // we can't reliably test typed array max-sizes in the browser\n    if (filename === 'test-buffer-big.js') {\n      line = line.replace(/(.*new Int8Array.*RangeError.*)/, '// $1')\n      line = line.replace(/(.*new ArrayBuffer.*RangeError.*)/, '// $1')\n      line = line.replace(/(.*new Float64Array.*RangeError.*)/, '// $1')\n    }\n\n    // https://github.com/iojs/io.js/blob/v0.12/test/parallel/test-buffer.js#L38\n    // we can't run this because we need to support\n    // browsers that don't have typed arrays\n    if (filename === 'test-buffer.js') {\n      line = line.replace(/b\\[0\\] = -1;/, 'b[0] = 255;')\n    }\n\n    // https://github.com/iojs/io.js/blob/v0.12/test/parallel/test-buffer.js#L1138\n    // unfortunately we can't run this as it touches\n    // node streams which do an instanceof check\n    // and crypto-browserify doesn't work in old\n    // versions of ie\n    if (filename === 'test-buffer.js') {\n      line = line.replace(/^(\\s*)(var crypto = require.*)/, '$1// $2')\n      line = line.replace(/(crypto.createHash.*\\))/, '1 /*$1*/')\n    }\n\n    cb(null, line + '\\n')\n  })\n}\n"]}