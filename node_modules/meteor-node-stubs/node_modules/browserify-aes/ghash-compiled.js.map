{"version":3,"sources":["ghash.js"],"names":[],"mappings":";;AAAA,IAAI,KAAK,GAAG,IAAI,MAAM,CAAC,EAAE,CAAC,CAAA;AAC1B,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;AACb,MAAM,CAAC,OAAO,GAAG,KAAK,CAAA;AACtB,SAAS,KAAK,CAAE,GAAG,EAAE;AACnB,MAAI,CAAC,CAAC,GAAG,GAAG,CAAA;AACZ,MAAI,CAAC,KAAK,GAAG,IAAI,MAAM,CAAC,EAAE,CAAC,CAAA;AAC3B,MAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;AAClB,MAAI,CAAC,KAAK,GAAG,IAAI,MAAM,CAAC,EAAE,CAAC,CAAA;CAC5B;;;AAGD,KAAK,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,KAAK,EAAE;AACvC,MAAI,CAAC,GAAG,CAAC,CAAC,CAAA;AACV,SAAO,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE;AACzB,QAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAA;GAC1B;AACD,MAAI,CAAC,SAAS,EAAE,CAAA;CACjB,CAAA;;AAED,KAAK,CAAC,SAAS,CAAC,SAAS,GAAG,YAAY;AACtC,MAAI,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;AACxB,MAAI,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;AACrB,MAAI,CAAC,EAAE,EAAE,EAAE,MAAM,CAAA;AACjB,MAAI,CAAC,GAAG,CAAC,CAAC,CAAA;AACV,SAAO,EAAE,CAAC,GAAG,GAAG,EAAE;AAChB,MAAE,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,EAAC,EAAE,CAAC,GAAG,CAAC,CAAA,AAAC,CAAC,GAAI,CAAC,IAAK,CAAC,GAAG,CAAC,GAAG,CAAC,AAAC,CAAC,KAAM,CAAC,CAAA;AACvD,QAAI,EAAE,EAAE;;AAEN,QAAE,GAAG,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;KACjB;;;AAGD,UAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA,KAAM,CAAC,CAAA;;;AAG1B,SAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AACtB,QAAE,CAAC,CAAC,CAAC,GAAG,AAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,GAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,AAAC,CAAA;KAChD;AACD,MAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAA;;;AAGnB,QAAI,MAAM,EAAE;AACV,QAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,GAAI,IAAI,IAAI,EAAE,AAAC,CAAA;KAC7B;GACF;AACD,MAAI,CAAC,KAAK,GAAG,SAAS,CAAC,EAAE,CAAC,CAAA;CAC3B,CAAA;AACD,KAAK,CAAC,SAAS,CAAC,MAAM,GAAG,UAAU,GAAG,EAAE;AACtC,MAAI,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAA;AAC7C,MAAI,KAAK,CAAA;AACT,SAAO,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,EAAE,EAAE;AAC9B,SAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAA;AAC/B,QAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;AACjC,QAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;GAClB;CACF,CAAA;AACD,KAAK,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,GAAG,EAAE,EAAE,EAAE;AACzC,MAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;AACrB,QAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;GACnD;AACD,MAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CACnB,CAAC,EAAE,GAAG,EACN,CAAC,EAAE,EAAE,CACN,CAAC,CAAC,CAAA;AACH,SAAO,IAAI,CAAC,KAAK,CAAA;CAClB,CAAA;;AAED,SAAS,OAAO,CAAE,GAAG,EAAE;AACrB,SAAO,CACL,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,EACnB,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,EACnB,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,EACnB,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC,CACrB,CAAA;CACF;AACD,SAAS,SAAS,CAAE,GAAG,EAAE;AACvB,KAAG,GAAG,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAA;AAC3B,MAAI,GAAG,GAAG,IAAI,MAAM,CAAC,EAAE,CAAC,CAAA;AACxB,KAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;AAC5B,KAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;AAC5B,KAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;AAC5B,KAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAA;AAC7B,SAAO,GAAG,CAAA;CACX;AACD,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CAAA;AAC9B,SAAS,YAAY,CAAE,CAAC,EAAE;AACxB,MAAI,GAAG,EAAE,KAAK,CAAA;AACd,KAAG,GAAG,CAAC,GAAG,QAAQ,IAAI,CAAC,GAAG,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,QAAQ,EAAE,CAAC,GAAG,CAAC,GAAG,QAAQ,GAAG,KAAK,GAAG,KAAK,CAAA,GAAI,CAAC,CAAA;AACpG,SAAO,GAAG,CAAA;CACX;AACD,SAAS,GAAG,CAAE,CAAC,EAAE,CAAC,EAAE;AAClB,SAAO,CACL,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EACX,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EACX,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EACX,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACZ,CAAA;CACF","file":"ghash-compiled.js","sourcesContent":["var zeros = new Buffer(16)\nzeros.fill(0)\nmodule.exports = GHASH\nfunction GHASH (key) {\n  this.h = key\n  this.state = new Buffer(16)\n  this.state.fill(0)\n  this.cache = new Buffer('')\n}\n// from http://bitwiseshiftleft.github.io/sjcl/doc/symbols/src/core_gcm.js.html\n// by Juho Vähä-Herttua\nGHASH.prototype.ghash = function (block) {\n  var i = -1\n  while (++i < block.length) {\n    this.state[i] ^= block[i]\n  }\n  this._multiply()\n}\n\nGHASH.prototype._multiply = function () {\n  var Vi = toArray(this.h)\n  var Zi = [0, 0, 0, 0]\n  var j, xi, lsb_Vi\n  var i = -1\n  while (++i < 128) {\n    xi = (this.state[~~(i / 8)] & (1 << (7 - i % 8))) !== 0\n    if (xi) {\n      // Z_i+1 = Z_i ^ V_i\n      Zi = xor(Zi, Vi)\n    }\n\n    // Store the value of LSB(V_i)\n    lsb_Vi = (Vi[3] & 1) !== 0\n\n    // V_i+1 = V_i >> 1\n    for (j = 3; j > 0; j--) {\n      Vi[j] = (Vi[j] >>> 1) | ((Vi[j - 1] & 1) << 31)\n    }\n    Vi[0] = Vi[0] >>> 1\n\n    // If LSB(V_i) is 1, V_i+1 = (V_i >> 1) ^ R\n    if (lsb_Vi) {\n      Vi[0] = Vi[0] ^ (0xe1 << 24)\n    }\n  }\n  this.state = fromArray(Zi)\n}\nGHASH.prototype.update = function (buf) {\n  this.cache = Buffer.concat([this.cache, buf])\n  var chunk\n  while (this.cache.length >= 16) {\n    chunk = this.cache.slice(0, 16)\n    this.cache = this.cache.slice(16)\n    this.ghash(chunk)\n  }\n}\nGHASH.prototype.final = function (abl, bl) {\n  if (this.cache.length) {\n    this.ghash(Buffer.concat([this.cache, zeros], 16))\n  }\n  this.ghash(fromArray([\n    0, abl,\n    0, bl\n  ]))\n  return this.state\n}\n\nfunction toArray (buf) {\n  return [\n    buf.readUInt32BE(0),\n    buf.readUInt32BE(4),\n    buf.readUInt32BE(8),\n    buf.readUInt32BE(12)\n  ]\n}\nfunction fromArray (out) {\n  out = out.map(fixup_uint32)\n  var buf = new Buffer(16)\n  buf.writeUInt32BE(out[0], 0)\n  buf.writeUInt32BE(out[1], 4)\n  buf.writeUInt32BE(out[2], 8)\n  buf.writeUInt32BE(out[3], 12)\n  return buf\n}\nvar uint_max = Math.pow(2, 32)\nfunction fixup_uint32 (x) {\n  var ret, x_pos\n  ret = x > uint_max || x < 0 ? (x_pos = Math.abs(x) % uint_max, x < 0 ? uint_max - x_pos : x_pos) : x\n  return ret\n}\nfunction xor (a, b) {\n  return [\n    a[0] ^ b[0],\n    a[1] ^ b[1],\n    a[2] ^ b[2],\n    a[3] ^ b[3]\n  ]\n}\n"]}