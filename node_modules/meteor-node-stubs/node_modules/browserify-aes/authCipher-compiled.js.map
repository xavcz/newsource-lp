{"version":3,"sources":["authCipher.js"],"names":[],"mappings":"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","file":"authCipher-compiled.js","sourcesContent":["var aes = require('./aes')\nvar Transform = require('cipher-base')\nvar inherits = require('inherits')\nvar GHASH = require('./ghash')\nvar xor = require('buffer-xor')\ninherits(StreamCipher, Transform)\nmodule.exports = StreamCipher\n\nfunction StreamCipher (mode, key, iv, decrypt) {\n  if (!(this instanceof StreamCipher)) {\n    return new StreamCipher(mode, key, iv)\n  }\n  Transform.call(this)\n  this._finID = Buffer.concat([iv, new Buffer([0, 0, 0, 1])])\n  iv = Buffer.concat([iv, new Buffer([0, 0, 0, 2])])\n  this._cipher = new aes.AES(key)\n  this._prev = new Buffer(iv.length)\n  this._cache = new Buffer('')\n  this._secCache = new Buffer('')\n  this._decrypt = decrypt\n  this._alen = 0\n  this._len = 0\n  iv.copy(this._prev)\n  this._mode = mode\n  var h = new Buffer(4)\n  h.fill(0)\n  this._ghash = new GHASH(this._cipher.encryptBlock(h))\n  this._authTag = null\n  this._called = false\n}\nStreamCipher.prototype._update = function (chunk) {\n  if (!this._called && this._alen) {\n    var rump = 16 - (this._alen % 16)\n    if (rump < 16) {\n      rump = new Buffer(rump)\n      rump.fill(0)\n      this._ghash.update(rump)\n    }\n  }\n  this._called = true\n  var out = this._mode.encrypt(this, chunk)\n  if (this._decrypt) {\n    this._ghash.update(chunk)\n  } else {\n    this._ghash.update(out)\n  }\n  this._len += chunk.length\n  return out\n}\nStreamCipher.prototype._final = function () {\n  if (this._decrypt && !this._authTag) {\n    throw new Error('Unsupported state or unable to authenticate data')\n  }\n  var tag = xor(this._ghash.final(this._alen * 8, this._len * 8), this._cipher.encryptBlock(this._finID))\n  if (this._decrypt) {\n    if (xorTest(tag, this._authTag)) {\n      throw new Error('Unsupported state or unable to authenticate data')\n    }\n  } else {\n    this._authTag = tag\n  }\n  this._cipher.scrub()\n}\nStreamCipher.prototype.getAuthTag = function getAuthTag () {\n  if (!this._decrypt && Buffer.isBuffer(this._authTag)) {\n    return this._authTag\n  } else {\n    throw new Error('Attempting to get auth tag in unsupported state')\n  }\n}\nStreamCipher.prototype.setAuthTag = function setAuthTag (tag) {\n  if (this._decrypt) {\n    this._authTag = tag\n  } else {\n    throw new Error('Attempting to set auth tag in unsupported state')\n  }\n}\nStreamCipher.prototype.setAAD = function setAAD (buf) {\n  if (!this._called) {\n    this._ghash.update(buf)\n    this._alen += buf.length\n  } else {\n    throw new Error('Attempting to set AAD in unsupported state')\n  }\n}\nfunction xorTest (a, b) {\n  var out = 0\n  if (a.length !== b.length) {\n    out++\n  }\n  var len = Math.min(a.length, b.length)\n  var i = -1\n  while (++i < len) {\n    out += (a[i] ^ b[i])\n  }\n  return out\n}\n"]}