{"version":3,"sources":["privateDecrypt.js"],"names":[],"mappings":"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","file":"privateDecrypt-compiled.js","sourcesContent":["var parseKeys = require('parse-asn1');\nvar mgf = require('./mgf');\nvar xor = require('./xor');\nvar bn = require('bn.js');\nvar crt = require('browserify-rsa');\nvar createHash = require('create-hash');\nvar withPublic = require('./withPublic');\nmodule.exports = function privateDecrypt(private_key, enc, reverse) {\n  var padding;\n  if (private_key.padding) {\n    padding = private_key.padding;\n  } else if (reverse) {\n    padding = 1;\n  } else {\n    padding = 4;\n  }\n  \n  var key = parseKeys(private_key);\n  var k = key.modulus.byteLength();\n  if (enc.length > k || new bn(enc).cmp(key.modulus) >= 0) {\n    throw new Error('decryption error');\n  }\n  var msg;\n  if (reverse) {\n    msg = withPublic(new bn(enc), key);\n  } else {\n    msg = crt(enc, key);\n  }\n  var zBuffer = new Buffer(k - msg.length);\n  zBuffer.fill(0);\n  msg = Buffer.concat([zBuffer, msg], k);\n  if (padding === 4) {\n    return oaep(key, msg);\n  } else if (padding === 1) {\n    return pkcs1(key, msg, reverse);\n  } else if (padding === 3) {\n    return msg;\n  } else {\n    throw new Error('unknown padding');\n  }\n};\n\nfunction oaep(key, msg){\n  var n = key.modulus;\n  var k = key.modulus.byteLength();\n  var mLen = msg.length;\n  var iHash = createHash('sha1').update(new Buffer('')).digest();\n  var hLen = iHash.length;\n  var hLen2 = 2 * hLen;\n  if (msg[0] !== 0) {\n    throw new Error('decryption error');\n  }\n  var maskedSeed = msg.slice(1, hLen + 1);\n  var maskedDb =  msg.slice(hLen + 1);\n  var seed = xor(maskedSeed, mgf(maskedDb, hLen));\n  var db = xor(maskedDb, mgf(seed, k - hLen - 1));\n  if (compare(iHash, db.slice(0, hLen))) {\n    throw new Error('decryption error');\n  }\n  var i = hLen;\n  while (db[i] === 0) {\n    i++;\n  }\n  if (db[i++] !== 1) {\n    throw new Error('decryption error');\n  }\n  return db.slice(i);\n}\n\nfunction pkcs1(key, msg, reverse){\n  var p1 = msg.slice(0, 2);\n  var i = 2;\n  var status = 0;\n  while (msg[i++] !== 0) {\n    if (i >= msg.length) {\n      status++;\n      break;\n    }\n  }\n  var ps = msg.slice(2, i - 1);\n  var p2 = msg.slice(i - 1, i);\n\n  if ((p1.toString('hex') !== '0002' && !reverse) || (p1.toString('hex') !== '0001' && reverse)){\n    status++;\n  }\n  if (ps.length < 8) {\n    status++;\n  }\n  if (status) {\n    throw new Error('decryption error');\n  }\n  return  msg.slice(i);\n}\nfunction compare(a, b){\n  a = new Buffer(a);\n  b = new Buffer(b);\n  var dif = 0;\n  var len = a.length;\n  if (a.length !== b.length) {\n    dif++;\n    len = Math.min(a.length, b.length);\n  }\n  var i = -1;\n  while (++i < len) {\n    dif += (a[i] ^ b[i]);\n  }\n  return dif;\n}"]}