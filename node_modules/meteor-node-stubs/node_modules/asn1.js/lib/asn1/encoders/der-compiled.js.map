{"version":3,"sources":["der.js"],"names":[],"mappings":"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","file":"der-compiled.js","sourcesContent":["var inherits = require('inherits');\nvar Buffer = require('buffer').Buffer;\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\nvar bignum = asn1.bignum;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DEREncoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DEREncoder;\n\nDEREncoder.prototype.encode = function encode(data, reporter) {\n  return this.tree._encode(data, reporter).join();\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._encodeComposite = function encodeComposite(tag,\n                                                              primitive,\n                                                              cls,\n                                                              content) {\n  var encodedTag = encodeTag(tag, primitive, cls, this.reporter);\n\n  // Short form\n  if (content.length < 0x80) {\n    var header = new Buffer(2);\n    header[0] = encodedTag;\n    header[1] = content.length;\n    return this._createEncoderBuffer([ header, content ]);\n  }\n\n  // Long form\n  // Count octets required to store length\n  var lenOctets = 1;\n  for (var i = content.length; i >= 0x100; i >>= 8)\n    lenOctets++;\n\n  var header = new Buffer(1 + 1 + lenOctets);\n  header[0] = encodedTag;\n  header[1] = 0x80 | lenOctets;\n\n  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8)\n    header[i] = j & 0xff;\n\n  return this._createEncoderBuffer([ header, content ]);\n};\n\nDERNode.prototype._encodeStr = function encodeStr(str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([ str.unused | 0, str.data ]);\n  } else if (tag === 'bmpstr') {\n    var buf = new Buffer(str.length * 2);\n    for (var i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2);\n    }\n    return this._createEncoderBuffer(buf);\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports ' +\n                                 'only digits and space');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports ' +\n                                 'only latin upper and lower case letters, ' +\n                                 'digits, space, apostrophe, left and rigth ' +\n                                 'parenthesis, plus sign, comma, hyphen, ' +\n                                 'dot, slash, colon, equal sign, ' +\n                                 'question mark');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str);\n  } else {\n    return this.reporter.error('Encoding of string type: ' + tag +\n                               ' unsupported');\n  }\n};\n\nDERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values)\n      return this.reporter.error('string objid given, but no values map found');\n    if (!values.hasOwnProperty(id))\n      return this.reporter.error('objid not found in values map');\n    id = values[id].split(/[\\s\\.]+/g);\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  } else if (Array.isArray(id)) {\n    id = id.slice();\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error('objid() should be either array or string, ' +\n                               'got: ' + JSON.stringify(id));\n  }\n\n  if (!relative) {\n    if (id[1] >= 40)\n      return this.reporter.error('Second objid identifier OOB');\n    id.splice(0, 2, id[0] * 40 + id[1]);\n  }\n\n  // Count number of octets\n  var size = 0;\n  for (var i = 0; i < id.length; i++) {\n    var ident = id[i];\n    for (size++; ident >= 0x80; ident >>= 7)\n      size++;\n  }\n\n  var objid = new Buffer(size);\n  var offset = objid.length - 1;\n  for (var i = id.length - 1; i >= 0; i--) {\n    var ident = id[i];\n    objid[offset--] = ident & 0x7f;\n    while ((ident >>= 7) > 0)\n      objid[offset--] = 0x80 | (ident & 0x7f);\n  }\n\n  return this._createEncoderBuffer(objid);\n};\n\nfunction two(num) {\n  if (num < 10)\n    return '0' + num;\n  else\n    return num;\n}\n\nDERNode.prototype._encodeTime = function encodeTime(time, tag) {\n  var str;\n  var date = new Date(time);\n\n  if (tag === 'gentime') {\n    str = [\n      two(date.getFullYear()),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else if (tag === 'utctime') {\n    str = [\n      two(date.getFullYear() % 100),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else {\n    this.reporter.error('Encoding ' + tag + ' time is not supported yet');\n  }\n\n  return this._encodeStr(str, 'octstr');\n};\n\nDERNode.prototype._encodeNull = function encodeNull() {\n  return this._createEncoderBuffer('');\n};\n\nDERNode.prototype._encodeInt = function encodeInt(num, values) {\n  if (typeof num === 'string') {\n    if (!values)\n      return this.reporter.error('String int or enum given, but no values map');\n    if (!values.hasOwnProperty(num)) {\n      return this.reporter.error('Values map doesn\\'t contain: ' +\n                                 JSON.stringify(num));\n    }\n    num = values[num];\n  }\n\n  // Bignum, assume big endian\n  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {\n    var numArray = num.toArray();\n    if (!num.sign && numArray[0] & 0x80) {\n      numArray.unshift(0);\n    }\n    num = new Buffer(numArray);\n  }\n\n  if (Buffer.isBuffer(num)) {\n    var size = num.length;\n    if (num.length === 0)\n      size++;\n\n    var out = new Buffer(size);\n    num.copy(out);\n    if (num.length === 0)\n      out[0] = 0\n    return this._createEncoderBuffer(out);\n  }\n\n  if (num < 0x80)\n    return this._createEncoderBuffer(num);\n\n  if (num < 0x100)\n    return this._createEncoderBuffer([0, num]);\n\n  var size = 1;\n  for (var i = num; i >= 0x100; i >>= 8)\n    size++;\n\n  var out = new Array(size);\n  for (var i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff;\n    num >>= 8;\n  }\n  if(out[0] & 0x80) {\n    out.unshift(0);\n  }\n\n  return this._createEncoderBuffer(new Buffer(out));\n};\n\nDERNode.prototype._encodeBool = function encodeBool(value) {\n  return this._createEncoderBuffer(value ? 0xff : 0);\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getEncoder('der').tree;\n};\n\nDERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {\n  var state = this._baseState;\n  var i;\n  if (state['default'] === null)\n    return false;\n\n  var data = dataBuffer.join();\n  if (state.defaultBuffer === undefined)\n    state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();\n\n  if (data.length !== state.defaultBuffer.length)\n    return false;\n\n  for (i=0; i < data.length; i++)\n    if (data[i] !== state.defaultBuffer[i])\n      return false;\n\n  return true;\n};\n\n// Utility methods\n\nfunction encodeTag(tag, primitive, cls, reporter) {\n  var res;\n\n  if (tag === 'seqof')\n    tag = 'seq';\n  else if (tag === 'setof')\n    tag = 'set';\n\n  if (der.tagByName.hasOwnProperty(tag))\n    res = der.tagByName[tag];\n  else if (typeof tag === 'number' && (tag | 0) === tag)\n    res = tag;\n  else\n    return reporter.error('Unknown tag: ' + tag);\n\n  if (res >= 0x1f)\n    return reporter.error('Multi-octet tag encoding unsupported');\n\n  if (!primitive)\n    res |= 0x20;\n\n  res |= (der.tagClassByName[cls || 'universal'] << 6);\n\n  return res;\n}\n"]}