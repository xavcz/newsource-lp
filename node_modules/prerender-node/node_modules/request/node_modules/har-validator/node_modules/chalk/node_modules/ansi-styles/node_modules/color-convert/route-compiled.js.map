{"version":3,"sources":["route.js"],"names":[],"mappings":"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","file":"route-compiled.js","sourcesContent":["var conversions = require('./conversions');\n\n/*\n\tthis function routes a model to all other models.\n\n\tall functions that are routed have a property `.conversion` attached\n\tto the returned synthetic function. This property is an array\n\tof strings, each with the steps in between the 'from' and 'to'\n\tcolor models (inclusive).\n\n\tconversions that are not possible simply are not included.\n*/\n\n// https://jsperf.com/object-keys-vs-for-in-with-closure/3\nvar models = Object.keys(conversions);\n\nfunction buildGraph() {\n\tvar graph = {};\n\n\tfor (var len = models.length, i = 0; i < len; i++) {\n\t\tgraph[models[i]] = {\n\t\t\t// http://jsperf.com/1-vs-infinity\n\t\t\t// micro-opt, but this is simple.\n\t\t\tdistance: -1,\n\t\t\tparent: null\n\t\t};\n\t}\n\n\treturn graph;\n}\n\n// https://en.wikipedia.org/wiki/Breadth-first_search\nfunction deriveBFS(fromModel) {\n\tvar graph = buildGraph();\n\tvar queue = [fromModel]; // unshift -> queue -> pop\n\n\tgraph[fromModel].distance = 0;\n\n\twhile (queue.length) {\n\t\tvar current = queue.pop();\n\t\tvar adjacents = Object.keys(conversions[current]);\n\n\t\tfor (var len = adjacents.length, i = 0; i < len; i++) {\n\t\t\tvar adjacent = adjacents[i];\n\t\t\tvar node = graph[adjacent];\n\n\t\t\tif (node.distance === -1) {\n\t\t\t\tnode.distance = graph[current].distance + 1;\n\t\t\t\tnode.parent = current;\n\t\t\t\tqueue.unshift(adjacent);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn graph;\n}\n\nfunction link(from, to) {\n\treturn function (args) {\n\t\treturn to(from(args));\n\t};\n}\n\nfunction wrapConversion(toModel, graph) {\n\tvar path = [graph[toModel].parent, toModel];\n\tvar fn = conversions[graph[toModel].parent][toModel];\n\n\tvar cur = graph[toModel].parent;\n\twhile (graph[cur].parent) {\n\t\tpath.unshift(graph[cur].parent);\n\t\tfn = link(conversions[graph[cur].parent][cur], fn);\n\t\tcur = graph[cur].parent;\n\t}\n\n\tfn.conversion = path;\n\treturn fn;\n}\n\nmodule.exports = function (fromModel) {\n\tvar graph = deriveBFS(fromModel);\n\tvar conversion = {};\n\n\tvar models = Object.keys(graph);\n\tfor (var len = models.length, i = 0; i < len; i++) {\n\t\tvar toModel = models[i];\n\t\tvar node = graph[toModel];\n\n\t\tif (node.parent === null) {\n\t\t\t// no possible conversion, or this node is the source model.\n\t\t\tcontinue;\n\t\t}\n\n\t\tconversion[toModel] = wrapConversion(toModel, graph);\n\t}\n\n\treturn conversion;\n};\n\n"]}