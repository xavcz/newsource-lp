{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["// Load modules\n\nvar Dgram = require('dgram');\nvar Dns = require('dns');\nvar Hoek = require('hoek');\n\n\n// Declare internals\n\nvar internals = {};\n\n\nexports.time = function (options, callback) {\n\n    if (arguments.length !== 2) {\n        callback = arguments[0];\n        options = {};\n    }\n\n    var settings = Hoek.clone(options);\n    settings.host = settings.host || 'pool.ntp.org';\n    settings.port = settings.port || 123;\n    settings.resolveReference = settings.resolveReference || false;\n\n    // Declare variables used by callback\n\n    var timeoutId = 0;\n    var sent = 0;\n\n    // Ensure callback is only called once\n\n    var finish = function (err, result) {\n\n        if (timeoutId) {\n            clearTimeout(timeoutId);\n            timeoutId = 0;\n        }\n\n        socket.removeAllListeners();\n        socket.once('error', internals.ignore);\n        socket.close();\n        return callback(err, result);\n    };\n\n    finish = Hoek.once(finish);\n\n    // Create UDP socket\n\n    var socket = Dgram.createSocket('udp4');\n\n    socket.once('error', function (err) {\n\n        return finish(err);\n    });\n\n    // Listen to incoming messages\n\n    socket.on('message', function (buffer, rinfo) {\n\n        var received = Date.now();\n\n        var message = new internals.NtpMessage(buffer);\n        if (!message.isValid) {\n            return finish(new Error('Invalid server response'), message);\n        }\n\n        if (message.originateTimestamp !== sent) {\n            return finish(new Error('Wrong originate timestamp'), message);\n        }\n\n        // Timestamp Name          ID   When Generated\n        // ------------------------------------------------------------\n        // Originate Timestamp     T1   time request sent by client\n        // Receive Timestamp       T2   time request received by server\n        // Transmit Timestamp      T3   time reply sent by server\n        // Destination Timestamp   T4   time reply received by client\n        //\n        // The roundtrip delay d and system clock offset t are defined as:\n        //\n        // d = (T4 - T1) - (T3 - T2)     t = ((T2 - T1) + (T3 - T4)) / 2\n\n        var T1 = message.originateTimestamp;\n        var T2 = message.receiveTimestamp;\n        var T3 = message.transmitTimestamp;\n        var T4 = received;\n\n        message.d = (T4 - T1) - (T3 - T2);\n        message.t = ((T2 - T1) + (T3 - T4)) / 2;\n        message.receivedLocally = received;\n\n        if (!settings.resolveReference ||\n            message.stratum !== 'secondary') {\n\n            return finish(null, message);\n        }\n\n        // Resolve reference IP address\n\n        Dns.reverse(message.referenceId, function (err, domains) {\n\n            if (/* $lab:coverage:off$ */ !err /* $lab:coverage:on$ */) {\n                message.referenceHost = domains[0];\n            }\n\n            return finish(null, message);\n        });\n    });\n\n    // Set timeout\n\n    if (settings.timeout) {\n        timeoutId = setTimeout(function () {\n\n            timeoutId = 0;\n            return finish(new Error('Timeout'));\n        }, settings.timeout);\n    }\n\n    // Construct NTP message\n\n    var message = new Buffer(48);\n    for (var i = 0; i < 48; i++) {                      // Zero message\n        message[i] = 0;\n    }\n\n    message[0] = (0 << 6) + (4 << 3) + (3 << 0)         // Set version number to 4 and Mode to 3 (client)\n    sent = Date.now();\n    internals.fromMsecs(sent, message, 40);               // Set transmit timestamp (returns as originate)\n\n    // Send NTP request\n\n    socket.send(message, 0, message.length, settings.port, settings.host, function (err, bytes) {\n\n        if (err ||\n            bytes !== 48) {\n\n            return finish(err || new Error('Could not send entire message'));\n        }\n    });\n};\n\n\ninternals.NtpMessage = function (buffer) {\n\n    this.isValid = false;\n\n    // Validate\n\n    if (buffer.length !== 48) {\n        return;\n    }\n\n    // Leap indicator\n\n    var li = (buffer[0] >> 6);\n    switch (li) {\n        case 0: this.leapIndicator = 'no-warning'; break;\n        case 1: this.leapIndicator = 'last-minute-61'; break;\n        case 2: this.leapIndicator = 'last-minute-59'; break;\n        case 3: this.leapIndicator = 'alarm'; break;\n    }\n\n    // Version\n\n    var vn = ((buffer[0] & 0x38) >> 3);\n    this.version = vn;\n\n    // Mode\n\n    var mode = (buffer[0] & 0x7);\n    switch (mode) {\n        case 1: this.mode = 'symmetric-active'; break;\n        case 2: this.mode = 'symmetric-passive'; break;\n        case 3: this.mode = 'client'; break;\n        case 4: this.mode = 'server'; break;\n        case 5: this.mode = 'broadcast'; break;\n        case 0:\n        case 6:\n        case 7: this.mode = 'reserved'; break;\n    }\n\n    // Stratum\n\n    var stratum = buffer[1];\n    if (stratum === 0) {\n        this.stratum = 'death';\n    }\n    else if (stratum === 1) {\n        this.stratum = 'primary';\n    }\n    else if (stratum <= 15) {\n        this.stratum = 'secondary';\n    }\n    else {\n        this.stratum = 'reserved';\n    }\n\n    // Poll interval (msec)\n\n    this.pollInterval = Math.round(Math.pow(2, buffer[2])) * 1000;\n\n    // Precision (msecs)\n\n    this.precision = Math.pow(2, buffer[3]) * 1000;\n\n    // Root delay (msecs)\n\n    var rootDelay = 256 * (256 * (256 * buffer[4] + buffer[5]) + buffer[6]) + buffer[7];\n    this.rootDelay = 1000 * (rootDelay / 0x10000);\n\n    // Root dispersion (msecs)\n\n    this.rootDispersion = ((buffer[8] << 8) + buffer[9] + ((buffer[10] << 8) + buffer[11]) / Math.pow(2, 16)) * 1000;\n\n    // Reference identifier\n\n    this.referenceId = '';\n    switch (this.stratum) {\n        case 'death':\n        case 'primary':\n            this.referenceId = String.fromCharCode(buffer[12]) + String.fromCharCode(buffer[13]) + String.fromCharCode(buffer[14]) + String.fromCharCode(buffer[15]);\n            break;\n        case 'secondary':\n            this.referenceId = '' + buffer[12] + '.' + buffer[13] + '.' + buffer[14] + '.' + buffer[15];\n            break;\n    }\n\n    // Reference timestamp\n\n    this.referenceTimestamp = internals.toMsecs(buffer, 16);\n\n    // Originate timestamp\n\n    this.originateTimestamp = internals.toMsecs(buffer, 24);\n\n    // Receive timestamp\n\n    this.receiveTimestamp = internals.toMsecs(buffer, 32);\n\n    // Transmit timestamp\n\n    this.transmitTimestamp = internals.toMsecs(buffer, 40);\n\n    // Validate\n\n    if (this.version === 4 &&\n        this.stratum !== 'reserved' &&\n        this.mode === 'server' &&\n        this.originateTimestamp &&\n        this.receiveTimestamp &&\n        this.transmitTimestamp) {\n\n        this.isValid = true;\n    }\n\n    return this;\n};\n\n\ninternals.toMsecs = function (buffer, offset) {\n\n    var seconds = 0;\n    var fraction = 0;\n\n    for (var i = 0; i < 4; ++i) {\n        seconds = (seconds * 256) + buffer[offset + i];\n    }\n\n    for (i = 4; i < 8; ++i) {\n        fraction = (fraction * 256) + buffer[offset + i];\n    }\n\n    return ((seconds - 2208988800 + (fraction / Math.pow(2, 32))) * 1000);\n};\n\n\ninternals.fromMsecs = function (ts, buffer, offset) {\n\n    var seconds = Math.floor(ts / 1000) + 2208988800;\n    var fraction = Math.round((ts % 1000) / 1000 * Math.pow(2, 32));\n\n    buffer[offset + 0] = (seconds & 0xFF000000) >> 24;\n    buffer[offset + 1] = (seconds & 0x00FF0000) >> 16;\n    buffer[offset + 2] = (seconds & 0x0000FF00) >> 8;\n    buffer[offset + 3] = (seconds & 0x000000FF);\n\n    buffer[offset + 4] = (fraction & 0xFF000000) >> 24;\n    buffer[offset + 5] = (fraction & 0x00FF0000) >> 16;\n    buffer[offset + 6] = (fraction & 0x0000FF00) >> 8;\n    buffer[offset + 7] = (fraction & 0x000000FF);\n};\n\n\n// Offset singleton\n\ninternals.last = {\n    offset: 0,\n    expires: 0,\n    host: '',\n    port: 0\n};\n\n\nexports.offset = function (options, callback) {\n\n    if (arguments.length !== 2) {\n        callback = arguments[0];\n        options = {};\n    }\n\n    var now = Date.now();\n    var clockSyncRefresh = options.clockSyncRefresh || 24 * 60 * 60 * 1000;                    // Daily\n\n    if (internals.last.offset &&\n        internals.last.host === options.host &&\n        internals.last.port === options.port &&\n        now < internals.last.expires) {\n\n        process.nextTick(function () {\n\n            callback(null, internals.last.offset);\n        });\n\n        return;\n    }\n\n    exports.time(options, function (err, time) {\n\n        if (err) {\n            return callback(err, 0);\n        }\n\n        internals.last = {\n            offset: Math.round(time.t),\n            expires: now + clockSyncRefresh,\n            host: options.host,\n            port: options.port\n        };\n\n        return callback(null, internals.last.offset);\n    });\n};\n\n\n// Now singleton\n\ninternals.now = {\n    intervalId: 0\n};\n\n\nexports.start = function (options, callback) {\n\n    if (arguments.length !== 2) {\n        callback = arguments[0];\n        options = {};\n    }\n\n    if (internals.now.intervalId) {\n        process.nextTick(function () {\n\n            callback();\n        });\n\n        return;\n    }\n\n    exports.offset(options, function (err, offset) {\n\n        internals.now.intervalId = setInterval(function () {\n\n            exports.offset(options, function () { });\n        }, options.clockSyncRefresh || 24 * 60 * 60 * 1000);                                // Daily\n\n        return callback();\n    });\n};\n\n\nexports.stop = function () {\n\n    if (!internals.now.intervalId) {\n        return;\n    }\n\n    clearInterval(internals.now.intervalId);\n    internals.now.intervalId = 0;\n};\n\n\nexports.isLive = function () {\n\n    return !!internals.now.intervalId;\n};\n\n\nexports.now = function () {\n\n    var now = Date.now();\n    if (!exports.isLive() ||\n        now >= internals.last.expires) {\n\n        return now;\n    }\n\n    return now + internals.last.offset;\n};\n\n\ninternals.ignore = function () {\n\n};\n"]}