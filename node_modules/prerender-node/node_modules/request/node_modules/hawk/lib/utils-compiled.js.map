{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["// Load modules\r\n\r\nvar Sntp = require('sntp');\r\nvar Boom = require('boom');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\nexports.version = function () {\r\n\r\n    return require('../package.json').version;\r\n};\r\n\r\n\r\nexports.limits = {\r\n    maxMatchLength: 4096            // Limit the length of uris and headers to avoid a DoS attack on string matching\r\n};\r\n\r\n\r\n// Extract host and port from request\r\n\r\n//                                            $1                            $2\r\ninternals.hostHeaderRegex = /^(?:(?:\\r\\n)?\\s)*((?:[^:]+)|(?:\\[[^\\]]+\\]))(?::(\\d+))?(?:(?:\\r\\n)?\\s)*$/;              // (IPv4, hostname)|(IPv6)\r\n\r\n\r\nexports.parseHost = function (req, hostHeaderName) {\r\n\r\n    hostHeaderName = (hostHeaderName ? hostHeaderName.toLowerCase() : 'host');\r\n    var hostHeader = req.headers[hostHeaderName];\r\n    if (!hostHeader) {\r\n        return null;\r\n    }\r\n\r\n    if (hostHeader.length > exports.limits.maxMatchLength) {\r\n        return null;\r\n    }\r\n\r\n    var hostParts = hostHeader.match(internals.hostHeaderRegex);\r\n    if (!hostParts) {\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        name: hostParts[1],\r\n        port: (hostParts[2] ? hostParts[2] : (req.connection && req.connection.encrypted ? 443 : 80))\r\n    };\r\n};\r\n\r\n\r\n// Parse Content-Type header content\r\n\r\nexports.parseContentType = function (header) {\r\n\r\n    if (!header) {\r\n        return '';\r\n    }\r\n\r\n    return header.split(';')[0].trim().toLowerCase();\r\n};\r\n\r\n\r\n// Convert node's  to request configuration object\r\n\r\nexports.parseRequest = function (req, options) {\r\n\r\n    if (!req.headers) {\r\n        return req;\r\n    }\r\n\r\n    // Obtain host and port information\r\n\r\n    var host;\r\n    if (!options.host ||\r\n        !options.port) {\r\n\r\n        host = exports.parseHost(req, options.hostHeaderName);\r\n        if (!host) {\r\n            return new Error('Invalid Host header');\r\n        }\r\n    }\r\n\r\n    var request = {\r\n        method: req.method,\r\n        url: req.url,\r\n        host: options.host || host.name,\r\n        port: options.port || host.port,\r\n        authorization: req.headers.authorization,\r\n        contentType: req.headers['content-type'] || ''\r\n    };\r\n\r\n    return request;\r\n};\r\n\r\n\r\nexports.now = function (localtimeOffsetMsec) {\r\n\r\n    return Sntp.now() + (localtimeOffsetMsec || 0);\r\n};\r\n\r\n\r\nexports.nowSecs = function (localtimeOffsetMsec) {\r\n\r\n    return Math.floor(exports.now(localtimeOffsetMsec) / 1000);\r\n};\r\n\r\n\r\ninternals.authHeaderRegex = /^(\\w+)(?:\\s+(.*))?$/;                                      // Header: scheme[ something]\r\ninternals.attributeRegex = /^[ \\w\\!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/\\:;<\\=>\\?@\\[\\]\\^`\\{\\|\\}~]+$/;   // !#$%&'()*+,-./:;<=>?@[]^_`{|}~ and space, a-z, A-Z, 0-9\r\n\r\n\r\n// Parse Hawk HTTP Authorization header\r\n\r\nexports.parseAuthorizationHeader = function (header, keys) {\r\n\r\n    keys = keys || ['id', 'ts', 'nonce', 'hash', 'ext', 'mac', 'app', 'dlg'];\r\n\r\n    if (!header) {\r\n        return Boom.unauthorized(null, 'Hawk');\r\n    }\r\n\r\n    if (header.length > exports.limits.maxMatchLength) {\r\n        return Boom.badRequest('Header length too long');\r\n    }\r\n\r\n    var headerParts = header.match(internals.authHeaderRegex);\r\n    if (!headerParts) {\r\n        return Boom.badRequest('Invalid header syntax');\r\n    }\r\n\r\n    var scheme = headerParts[1];\r\n    if (scheme.toLowerCase() !== 'hawk') {\r\n        return Boom.unauthorized(null, 'Hawk');\r\n    }\r\n\r\n    var attributesString = headerParts[2];\r\n    if (!attributesString) {\r\n        return Boom.badRequest('Invalid header syntax');\r\n    }\r\n\r\n    var attributes = {};\r\n    var errorMessage = '';\r\n    var verify = attributesString.replace(/(\\w+)=\"([^\"\\\\]*)\"\\s*(?:,\\s*|$)/g, function ($0, $1, $2) {\r\n\r\n        // Check valid attribute names\r\n\r\n        if (keys.indexOf($1) === -1) {\r\n            errorMessage = 'Unknown attribute: ' + $1;\r\n            return;\r\n        }\r\n\r\n        // Allowed attribute value characters\r\n\r\n        if ($2.match(internals.attributeRegex) === null) {\r\n            errorMessage = 'Bad attribute value: ' + $1;\r\n            return;\r\n        }\r\n\r\n        // Check for duplicates\r\n\r\n        if (attributes.hasOwnProperty($1)) {\r\n            errorMessage = 'Duplicate attribute: ' + $1;\r\n            return;\r\n        }\r\n\r\n        attributes[$1] = $2;\r\n        return '';\r\n    });\r\n\r\n    if (verify !== '') {\r\n        return Boom.badRequest(errorMessage || 'Bad header format');\r\n    }\r\n\r\n    return attributes;\r\n};\r\n\r\n\r\nexports.unauthorized = function (message, attributes) {\r\n\r\n    return Boom.unauthorized(message, 'Hawk', attributes);\r\n};\r\n\r\n"]}