{"version":3,"sources":["combined_stream.js"],"names":[],"mappings":"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","file":"combined_stream-compiled.js","sourcesContent":["var util = require('util');\nvar Stream = require('stream').Stream;\nvar DelayedStream = require('delayed-stream');\n\nmodule.exports = CombinedStream;\nfunction CombinedStream() {\n  this.writable = false;\n  this.readable = true;\n  this.dataSize = 0;\n  this.maxDataSize = 2 * 1024 * 1024;\n  this.pauseStreams = true;\n\n  this._released = false;\n  this._streams = [];\n  this._currentStream = null;\n}\nutil.inherits(CombinedStream, Stream);\n\nCombinedStream.create = function(options) {\n  var combinedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    combinedStream[option] = options[option];\n  }\n\n  return combinedStream;\n};\n\nCombinedStream.isStreamLike = function(stream) {\n  return (typeof stream !== 'function')\n    && (typeof stream !== 'string')\n    && (typeof stream !== 'boolean')\n    && (typeof stream !== 'number')\n    && (!Buffer.isBuffer(stream));\n};\n\nCombinedStream.prototype.append = function(stream) {\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n\n  if (isStreamLike) {\n    if (!(stream instanceof DelayedStream)) {\n      var newStream = DelayedStream.create(stream, {\n        maxDataSize: Infinity,\n        pauseStream: this.pauseStreams,\n      });\n      stream.on('data', this._checkDataSize.bind(this));\n      stream = newStream;\n    }\n\n    this._handleErrors(stream);\n\n    if (this.pauseStreams) {\n      stream.pause();\n    }\n  }\n\n  this._streams.push(stream);\n  return this;\n};\n\nCombinedStream.prototype.pipe = function(dest, options) {\n  Stream.prototype.pipe.call(this, dest, options);\n  this.resume();\n  return dest;\n};\n\nCombinedStream.prototype._getNext = function() {\n  this._currentStream = null;\n  var stream = this._streams.shift();\n\n\n  if (typeof stream == 'undefined') {\n    this.end();\n    return;\n  }\n\n  if (typeof stream !== 'function') {\n    this._pipeNext(stream);\n    return;\n  }\n\n  var getStream = stream;\n  getStream(function(stream) {\n    var isStreamLike = CombinedStream.isStreamLike(stream);\n    if (isStreamLike) {\n      stream.on('data', this._checkDataSize.bind(this));\n      this._handleErrors(stream);\n    }\n\n    this._pipeNext(stream);\n  }.bind(this));\n};\n\nCombinedStream.prototype._pipeNext = function(stream) {\n  this._currentStream = stream;\n\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n  if (isStreamLike) {\n    stream.on('end', this._getNext.bind(this));\n    stream.pipe(this, {end: false});\n    return;\n  }\n\n  var value = stream;\n  this.write(value);\n  this._getNext();\n};\n\nCombinedStream.prototype._handleErrors = function(stream) {\n  var self = this;\n  stream.on('error', function(err) {\n    self._emitError(err);\n  });\n};\n\nCombinedStream.prototype.write = function(data) {\n  this.emit('data', data);\n};\n\nCombinedStream.prototype.pause = function() {\n  if (!this.pauseStreams) {\n    return;\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.pause) == 'function') this._currentStream.pause();\n  this.emit('pause');\n};\n\nCombinedStream.prototype.resume = function() {\n  if (!this._released) {\n    this._released = true;\n    this.writable = true;\n    this._getNext();\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.resume) == 'function') this._currentStream.resume();\n  this.emit('resume');\n};\n\nCombinedStream.prototype.end = function() {\n  this._reset();\n  this.emit('end');\n};\n\nCombinedStream.prototype.destroy = function() {\n  this._reset();\n  this.emit('close');\n};\n\nCombinedStream.prototype._reset = function() {\n  this.writable = false;\n  this._streams = [];\n  this._currentStream = null;\n};\n\nCombinedStream.prototype._checkDataSize = function() {\n  this._updateDataSize();\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.';\n  this._emitError(new Error(message));\n};\n\nCombinedStream.prototype._updateDataSize = function() {\n  this.dataSize = 0;\n\n  var self = this;\n  this._streams.forEach(function(stream) {\n    if (!stream.dataSize) {\n      return;\n    }\n\n    self.dataSize += stream.dataSize;\n  });\n\n  if (this._currentStream && this._currentStream.dataSize) {\n    this.dataSize += this._currentStream.dataSize;\n  }\n};\n\nCombinedStream.prototype._emitError = function(err) {\n  this._reset();\n  this.emit('error', err);\n};\n"]}