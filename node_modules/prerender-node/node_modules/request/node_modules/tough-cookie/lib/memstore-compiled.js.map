{"version":3,"sources":["memstore.js"],"names":[],"mappings":"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","file":"memstore-compiled.js","sourcesContent":["/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n'use strict';\nvar Store = require('./store').Store;\nvar permuteDomain = require('./permuteDomain').permuteDomain;\nvar pathMatch = require('./pathMatch').pathMatch;\nvar util = require('util');\n\nfunction MemoryCookieStore() {\n  Store.call(this);\n  this.idx = {};\n}\nutil.inherits(MemoryCookieStore, Store);\nexports.MemoryCookieStore = MemoryCookieStore;\nMemoryCookieStore.prototype.idx = null;\n\n// Since it's just a struct in RAM, this Store is synchronous\nMemoryCookieStore.prototype.synchronous = true;\n\n// force a default depth:\nMemoryCookieStore.prototype.inspect = function() {\n  return \"{ idx: \"+util.inspect(this.idx, false, 2)+' }';\n};\n\nMemoryCookieStore.prototype.findCookie = function(domain, path, key, cb) {\n  if (!this.idx[domain]) {\n    return cb(null,undefined);\n  }\n  if (!this.idx[domain][path]) {\n    return cb(null,undefined);\n  }\n  return cb(null,this.idx[domain][path][key]||null);\n};\n\nMemoryCookieStore.prototype.findCookies = function(domain, path, cb) {\n  var results = [];\n  if (!domain) {\n    return cb(null,[]);\n  }\n\n  var pathMatcher;\n  if (!path) {\n    // null means \"all paths\"\n    pathMatcher = function matchAll(domainIndex) {\n      for (var curPath in domainIndex) {\n        var pathIndex = domainIndex[curPath];\n        for (var key in pathIndex) {\n          results.push(pathIndex[key]);\n        }\n      }\n    };\n\n  } else {\n    pathMatcher = function matchRFC(domainIndex) {\n       //NOTE: we should use path-match algorithm from S5.1.4 here\n       //(see : https://github.com/ChromiumWebApps/chromium/blob/b3d3b4da8bb94c1b2e061600df106d590fda3620/net/cookies/canonical_cookie.cc#L299)\n       Object.keys(domainIndex).forEach(function (cookiePath) {\n         if (pathMatch(path, cookiePath)) {\n           var pathIndex = domainIndex[cookiePath];\n\n           for (var key in pathIndex) {\n             results.push(pathIndex[key]);\n           }\n         }\n       });\n     };\n  }\n\n  var domains = permuteDomain(domain) || [domain];\n  var idx = this.idx;\n  domains.forEach(function(curDomain) {\n    var domainIndex = idx[curDomain];\n    if (!domainIndex) {\n      return;\n    }\n    pathMatcher(domainIndex);\n  });\n\n  cb(null,results);\n};\n\nMemoryCookieStore.prototype.putCookie = function(cookie, cb) {\n  if (!this.idx[cookie.domain]) {\n    this.idx[cookie.domain] = {};\n  }\n  if (!this.idx[cookie.domain][cookie.path]) {\n    this.idx[cookie.domain][cookie.path] = {};\n  }\n  this.idx[cookie.domain][cookie.path][cookie.key] = cookie;\n  cb(null);\n};\n\nMemoryCookieStore.prototype.updateCookie = function(oldCookie, newCookie, cb) {\n  // updateCookie() may avoid updating cookies that are identical.  For example,\n  // lastAccessed may not be important to some stores and an equality\n  // comparison could exclude that field.\n  this.putCookie(newCookie,cb);\n};\n\nMemoryCookieStore.prototype.removeCookie = function(domain, path, key, cb) {\n  if (this.idx[domain] && this.idx[domain][path] && this.idx[domain][path][key]) {\n    delete this.idx[domain][path][key];\n  }\n  cb(null);\n};\n\nMemoryCookieStore.prototype.removeCookies = function(domain, path, cb) {\n  if (this.idx[domain]) {\n    if (path) {\n      delete this.idx[domain][path];\n    } else {\n      delete this.idx[domain];\n    }\n  }\n  return cb(null);\n};\n\nMemoryCookieStore.prototype.getAllCookies = function(cb) {\n  var cookies = [];\n  var idx = this.idx;\n\n  var domains = Object.keys(idx);\n  domains.forEach(function(domain) {\n    var paths = Object.keys(idx[domain]);\n    paths.forEach(function(path) {\n      var keys = Object.keys(idx[domain][path]);\n      keys.forEach(function(key) {\n        if (key !== null) {\n          cookies.push(idx[domain][path][key]);\n        }\n      });\n    });\n  });\n\n  // Sort by creationIndex so deserializing retains the creation order.\n  // When implementing your own store, this SHOULD retain the order too\n  cookies.sort(function(a,b) {\n    return (a.creationIndex||0) - (b.creationIndex||0);\n  });\n\n  cb(null, cookies);\n};\n"]}