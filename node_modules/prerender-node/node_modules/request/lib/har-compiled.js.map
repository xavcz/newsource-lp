{"version":3,"sources":["har.js"],"names":[],"mappings":"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","file":"har-compiled.js","sourcesContent":["'use strict'\n\nvar fs = require('fs')\nvar qs = require('querystring')\nvar validate = require('har-validator')\nvar extend = require('extend')\n\nfunction Har (request) {\n  this.request = request\n}\n\nHar.prototype.reducer = function (obj, pair) {\n  // new property ?\n  if (obj[pair.name] === undefined) {\n    obj[pair.name] = pair.value\n    return obj\n  }\n\n  // existing? convert to array\n  var arr = [\n    obj[pair.name],\n    pair.value\n  ]\n\n  obj[pair.name] = arr\n\n  return obj\n}\n\nHar.prototype.prep = function (data) {\n  // construct utility properties\n  data.queryObj = {}\n  data.headersObj = {}\n  data.postData.jsonObj = false\n  data.postData.paramsObj = false\n\n  // construct query objects\n  if (data.queryString && data.queryString.length) {\n    data.queryObj = data.queryString.reduce(this.reducer, {})\n  }\n\n  // construct headers objects\n  if (data.headers && data.headers.length) {\n    // loweCase header keys\n    data.headersObj = data.headers.reduceRight(function (headers, header) {\n      headers[header.name] = header.value\n      return headers\n    }, {})\n  }\n\n  // construct Cookie header\n  if (data.cookies && data.cookies.length) {\n    var cookies = data.cookies.map(function (cookie) {\n      return cookie.name + '=' + cookie.value\n    })\n\n    if (cookies.length) {\n      data.headersObj.cookie = cookies.join('; ')\n    }\n  }\n\n  // prep body\n  function some (arr) {\n    return arr.some(function (type) {\n      return data.postData.mimeType.indexOf(type) === 0\n    })\n  }\n\n  if (some([\n    'multipart/mixed',\n    'multipart/related',\n    'multipart/form-data',\n    'multipart/alternative'])) {\n\n    // reset values\n    data.postData.mimeType = 'multipart/form-data'\n  }\n\n  else if (some([\n    'application/x-www-form-urlencoded'])) {\n\n    if (!data.postData.params) {\n      data.postData.text = ''\n    } else {\n      data.postData.paramsObj = data.postData.params.reduce(this.reducer, {})\n\n      // always overwrite\n      data.postData.text = qs.stringify(data.postData.paramsObj)\n    }\n  }\n\n  else if (some([\n    'text/json',\n    'text/x-json',\n    'application/json',\n    'application/x-json'])) {\n\n    data.postData.mimeType = 'application/json'\n\n    if (data.postData.text) {\n      try {\n        data.postData.jsonObj = JSON.parse(data.postData.text)\n      } catch (e) {\n        this.request.debug(e)\n\n        // force back to text/plain\n        data.postData.mimeType = 'text/plain'\n      }\n    }\n  }\n\n  return data\n}\n\nHar.prototype.options = function (options) {\n  // skip if no har property defined\n  if (!options.har) {\n    return options\n  }\n\n  var har = {}\n  extend(har, options.har)\n\n  // only process the first entry\n  if (har.log && har.log.entries) {\n    har = har.log.entries[0]\n  }\n\n  // add optional properties to make validation successful\n  har.url = har.url || options.url || options.uri || options.baseUrl || '/'\n  har.httpVersion = har.httpVersion || 'HTTP/1.1'\n  har.queryString = har.queryString || []\n  har.headers = har.headers || []\n  har.cookies = har.cookies || []\n  har.postData = har.postData || {}\n  har.postData.mimeType = har.postData.mimeType || 'application/octet-stream'\n\n  har.bodySize = 0\n  har.headersSize = 0\n  har.postData.size = 0\n\n  if (!validate.request(har)) {\n    return options\n  }\n\n  // clean up and get some utility properties\n  var req = this.prep(har)\n\n  // construct new options\n  if (req.url) {\n    options.url = req.url\n  }\n\n  if (req.method) {\n    options.method = req.method\n  }\n\n  if (Object.keys(req.queryObj).length) {\n    options.qs = req.queryObj\n  }\n\n  if (Object.keys(req.headersObj).length) {\n    options.headers = req.headersObj\n  }\n\n  function test (type) {\n    return req.postData.mimeType.indexOf(type) === 0\n  }\n  if (test('application/x-www-form-urlencoded')) {\n    options.form = req.postData.paramsObj\n  }\n  else if (test('application/json')) {\n    if (req.postData.jsonObj) {\n      options.body = req.postData.jsonObj\n      options.json = true\n    }\n  }\n  else if (test('multipart/form-data')) {\n    options.formData = {}\n\n    req.postData.params.forEach(function (param) {\n      var attachment = {}\n\n      if (!param.fileName && !param.fileName && !param.contentType) {\n        options.formData[param.name] = param.value\n        return\n      }\n\n      // attempt to read from disk!\n      if (param.fileName && !param.value) {\n        attachment.value = fs.createReadStream(param.fileName)\n      } else if (param.value) {\n        attachment.value = param.value\n      }\n\n      if (param.fileName) {\n        attachment.options = {\n          filename: param.fileName,\n          contentType: param.contentType ? param.contentType : null\n        }\n      }\n\n      options.formData[param.name] = attachment\n    })\n  }\n  else {\n    if (req.postData.text) {\n      options.body = req.postData.text\n    }\n  }\n\n  return options\n}\n\nexports.Har = Har\n"]}